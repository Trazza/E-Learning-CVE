<template name="x3d_template" >
	<x3d>
	  <scene>
	  	<!-- <navigationinfo id="nav_id" type="none" headlight="false"></navigationinfo>  --> 	
	  	
	  	<!-- ground -->
	  	<transform scale='0.00000001 0.00000001 0.00000001' rotation="-1.5707963267948966 0 0 1.5707963267948966">
		  	<shape>
		  		<appearance>	
			  		<material diffuseColor="#4A9"></material>
			  	</appearance>
			  	<plane size="20 20"></plane>
			  </shape>
		</transform>
		 
		{{#if on}}
			<group id='all_stage'>
	  			{{#each stages}}
					<transform DEF="stage" id="stage_id" translation="0 0 0" scale="0.1 0.1 0.1" >
       	 					<inline nameSpaceName="stage" 
            						mapDEFToID="true"
            						onload="Meteor.call('findEvent');"
            						url="/x3d/{{stage}}.x3d">
                  		 			
           					</inline>
     				</transform>
     			{{/each}}
     		</group>
     	<!-- onclick='Meteor.call("{{action}}", "{{attr}}","{{succF}}","{{succA}}","{{failF}}","{{failA}}");' -->
			<group id='all_objects'> 
				{{#each objects}}
					<transform DEF="{{name}}" id="{{_id}}" translation="{{x}} 2 {{z}}" scale="0.1 0.1 0.1" rotation="0 1 0 -1.5708">
       	 				<inline nameSpaceName="{{name}}" 
            					mapDEFToID="true"
            					onload='Meteor.call("findEvent", "{{_id}}","{{event}}","{{action}}", "{{attr}}","{{succF}}","{{succA}}","{{failF}}","{{failA}}");'
            			 
                  		 		url="/x3d/{{name}}.x3d">
                  	 
           				</inline>
     				</transform>
     			{{/each}}
     		</group>     	
			
	  		<group id="all_players">
	    		{{#each players}}
	    			<Viewpoint id="first-person{{_id}}" 
	    					   position="{{x}} {{y_view}} {{z}}" 
	    					   orientation="{{fp_view}} 0 0 1"
	    					   description="camera">
	    			</Viewpoint> 
	    	
	    			<transform id="{{_id}}" translation="{{x}} {{y}} {{z}}" scale="0.5 0.5 0.5">
       	 				<inline nameSpaceName="{{_id}}" 
            					mapDEFToID="true"
            					onload='Meteor.call("all_players_color", "{{_id}}", "{{color}}");'
                  		 		url="/x3d/LEGO_MAN.x3d">   	 
           				</inline>
     				</transform>		
	    		{{/each}}
	  		</group>
			
     	{{else}}
     		<!-- camera/scene settings -->
		
     		<transform DEF="stage" id="stage_id" translation="0 0 0" scale="0.1 0.1 0.1" >
       	 		<inline nameSpaceName="stage" 
            			mapDEFToID="true"
            			url="/x3d/piano_viola.x3d">
                  	 	
           		</inline>
     		</transform>
		
	  	{{/if}} 
	  <!-- Tanle 

		{{event}}='Meteor.call({{action}},{{attr}},{{succF}},{{succA}},{{failF}},{{failA}});'

     	<ProximitySensor id="table_sensor_id" enabled="true" center="3 0 -10" size="3 3 3"></ProximitySensor> 
     	<transform DEF="wood_table" id="wood_table_id" translation="3 0 -10" scale="1 1 1" rotation="0 1 0 -1.5708">
       	 		<inline nameSpaceName="wood_table" 
            			mapDEFToID="true" 
                  	 	url="/x3d/wood_table.x3d">
                  	 
           		</inline>
     	</transform>		
     	-->
	  </scene>
	</x3d>
</template>

<template name="on_template">
		<!-- camera/scene settings -->
		<viewpoint 	id="viewpoint_1"
	  				position="8.19 12.33 19.5"
	  				orientation="-0.834 0.55 0 0.65"></viewpoint>
	 
	  	
     	
     	<!--<navigationinfo id="nav_id" type="none" headlight="false"></navigationinfo>-->
	  	<!-- lights -->
	  	<pointLight location="0 40 0" intensity="0.3"></pointLight>
	  	<pointLight location="-30 10 -20" intensity="0.7"></pointLight>
	  	<directionalLight direction="-1 -1 -0.7" color="#ffe"
	  		intensity="0.8" shadowIntensity="0.4"></directionalLight>

	  	
	  	<group id='all_stage'>
	  		{{#each stages}}
				<transform DEF="stage" id="stage_id" translation="0 0 0" scale="0.1 0.1 0.1" >
       	 				<inline nameSpaceName="stage" 
            					mapDEFToID="true"
            					url="/x3d/{{stage}}.x3d">
                  		 	
           				</inline>
     			</transform>
     		{{/each}}
     	</group>
     	

     	<!-- onclick='Meteor.call("{{action}}", "{{attr}}","{{succF}}","{{succA}}","{{failF}}","{{failA}}");' -->
		<group id='all_objects'> 
			{{#each objects}}
				<transform DEF="{{name}}" id="{{name}}_id" translation="{{x}} 2 {{z}}" scale="0.1 0.1 0.1" rotation="0 1 0 -1.5708">
       	 			<inline nameSpaceName="{{name}}" 
            				mapDEFToID="true"
            				
            			 
                  		 	url="/x3d/{{name}}.x3d">
                  	 
           			</inline>
     			</transform>
     		{{/each}}
     	</group>     	
			
	  	<group id="all_players">
	    	{{#each players}}
	    		<Viewpoint id="first-person{{_id}}" 
	    				   position="{{x}} {{y_view}} {{z}}" 
	    				   orientation="{{fp_view}} 0 0 1"
	    				   description="camera">
	    		</Viewpoint> 
	    	
	    		<transform id="{{_id}}" translation="{{x}} {{y}} {{z}}" scale="0.5 0.5 0.5">
       	 			<inline nameSpaceName="{{_id}}" 
            				mapDEFToID="true"
            				onload='Meteor.call("all_players_color", "{{_id}}", "{{color}}");'
                  		 	url="/x3d/LEGO_MAN.x3d">   	 
           			</inline>
     			</transform>		
	    	{{/each}}
	  	</group>
</template>


